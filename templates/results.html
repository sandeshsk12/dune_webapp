{% extends "base.html" %}
{% block content %}

  {% if df is not none %}
    <div class="card">
      <p><strong>Success:</strong> Retrieved {{ total }} rows.</p>
      <div style="overflow:auto; max-height:60vh;">
        {{ df.to_html(index=False) | safe }}
      </div>

      <form method="POST" action="{{ url_for('download') }}" style="margin-top:12px;">
        <input type="hidden" name="api_key" value="{{ api_key }}">
        <input type="hidden" name="query_id" value="{{ query_id }}">

        <label for="filename" style="display:block; margin:10px 0 6px;">File name</label>
        <input id="filename" name="filename" type="text"
               placeholder="my_results.csv"
               value="{{ suggested_name }}"
               style="width:100%; padding:10px; border:1px solid #ccc; border-radius:8px;">

        <button class="btn btn-primary" type="submit" style="margin-top:10px;">
          ðŸ“¥ Download Results as CSV
        </button>
      </form>

      <p style="margin-top:8px;color:#666;">
        Tip: if you leave the field empty, a default name with UTC timestamp will be used.
      </p>
    </div>
  {% else %}
    <div class="card">
      <p>The API response was not in the expected format.</p>
      <pre style="white-space:pre-wrap;">{{ raw_json | tojson(indent=2) }}</pre>
    </div>
  {% endif %}

  <a class="btn" href="{{ url_for('index') }}">â¬… Back</a>
{% endblock %}
